<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2026 È¶¨Âπ¥Ë≥ÄÊ≠≤Áâà</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Ma+Shan+Zheng&family=ZCOOL+KuaiLe&family=Press+Start+2P&display=swap');
        
        body { 
            text-align: center; 
            background: #f0f0f0; 
            color: #333; 
            font-family: "Microsoft JhengHei", "PingFang TC", sans-serif; 
            margin: 0;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            overflow: hidden; 
            touch-action: manipulation;
            transition: background 2s ease;
        }

        /* Ê∑±Â§úÊ®°ÂºèËÉåÊôØ */
        body.is-night {
            background: #0a0a20;
        }

        /* Ë¶∫ÈÜíÊ®°ÂºèËÉåÊôØ */
        body.awakened {
            background: #050510;
        }

        #game-container {
            position: relative;
            width: 800px;
            max-width: 95vw;
            margin: 0 auto;
            cursor: pointer;
        }

        h1 { 
            margin: 10px 0; 
            font-size: 2.5rem; 
            color: #8b0000;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
            font-family: 'Ma Shan Zheng', cursive; 
            transition: all 1.5s ease;
        }
        
        body.is-night h1 {
            color: #d4af37;
        }

        body.awakened h1 {
            color: #ffda44;
            text-shadow: 0 0 15px rgba(255, 218, 68, 0.6);
        }

        .info { 
            font-size: 12px; 
            color: #666;
            margin-bottom: 10px;
            opacity: 0.8;
            transition: color 1.5s ease;
        }
        body.is-night .info { color: #888; }

        canvas { 
            border: 4px solid #eeeeee; 
            background: #ffffff; 
            display: block; 
            image-rendering: pixelated; 
            box-shadow: 0 4px 30px rgba(0,0,0,0.1);
            border-radius: 12px;
            width: 100%;
            transition: all 2s ease;
        }

        body.is-night canvas {
            background: #0d0d2b;
            border-color: #1a1a3a;
        }

        .score-overlay {
            position: absolute;
            top: 15px;
            right: 15px;
            font-family: 'Press Start 2P', cursive;
            font-size: 12px;
            color: #8b0000;
            text-align: right;
            pointer-events: none;
            transition: color 1.5s ease;
            z-index: 10;
        }
        body.is-night .score-overlay { color: #d4af37; }
        body.awakened .score-overlay { color: #ffda44; }

        #game-restart-btn {
            position: absolute;
            top: 75%; 
            left: 50%;
            transform: translate(-50%, -50%);
            display: none;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            z-index: 100; 
        }

        .restart-icon {
            width: 54px;
            height: 54px;
            background: #8b0000;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            transition: transform 0.2s;
        }
        body.is-night .restart-icon { background: #d4af37; }
        body.is-night .restart-icon svg { stroke: #0a0a20; }
    </style>
</head>
<body>

    <h1 id="game-title">üßßüêéüßßüêéüßß</h1>
    <div class="info" id="game-status">Ë∑ùÈõ¢ 1500 ÈÄ≤ÂÖ•ÊòüÁ©∫Ê®°Âºè</div>

    <div id="game-container" onclick="handleClick()">
        <canvas id="gameCanvas" width="800" height="250"></canvas>
        
        <div class="score-overlay">
            HI <span id="high-score">00000</span> <span id="current-distance">00000</span>
        </div>

        <div id="game-restart-btn" onclick="resetGame(); event.stopPropagation();">
            <div class="restart-icon">
                <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M23 4v6h-6"></path>
                    <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"></path>
                </svg>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const distanceDisplay = document.getElementById('current-distance');
        const highScoreDisplay = document.getElementById('high-score');
        const restartBtn = document.getElementById('game-restart-btn');
        const body = document.body;
        const title = document.getElementById('game-title');
        const statusText = document.getElementById('game-status');

        let distance = 0; 
        let highScore = 0;
        let gameActive = true;
        let frame = 0;
        let nextObstacleFrame = 100; 
        const obstacles = [];
        const fireworks = []; 
        const stars = [];
        let isNight = false;
        let isAwakened = false;
        
        let awakeningFireworkTimer = 0;
        let gameOverFrameCount = 0;

        const s = 0.7; 

        const horse = {
            x: 100, y: 195, width: 40 * s, height: 32 * s,
            dy: 0, jumpForce: 11, gravity: 0.65, grounded: false, ducking: false, groundY: 195 
        };

        function initStars() {
            stars.length = 0;
            for(let i = 0; i < 60; i++) {
                stars.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * (canvas.height - 50),
                    size: Math.random() * 1.5,
                    opacity: Math.random(),
                    speed: 0.01 + Math.random() * 0.02
                });
            }
        }

        function formatNumber(num) {
            return Math.floor(num).toString().padStart(5, '0');
        }

        class Particle {
            constructor(x, y, color, speedX, speedY, life = 60) {
                this.x = x; this.y = y; this.color = color;
                this.size = Math.random() * 3 + 1.5;
                this.speedX = speedX || (Math.random() - 0.5) * 8;
                this.speedY = speedY || (Math.random() - 0.5) * 8;
                this.gravity = 0.08; this.opacity = 1; this.life = life; this.fade = 1 / life;
            }
            update() {
                this.speedY += this.gravity; this.x += this.speedX; this.y += this.speedY;
                this.opacity -= this.fade; this.life--;
            }
            draw() {
                if (this.opacity <= 0) return;
                ctx.save(); ctx.globalAlpha = this.opacity; ctx.fillStyle = this.color;
                ctx.fillRect(this.x, this.y, this.size, this.size); ctx.restore();
            }
        }

        function createFirework(x, y) {
            const colors = ['#FFD700', '#FF4500', '#FF1493', '#00FF7F', '#1E90FF', '#FFFFFF'];
            const color = colors[Math.floor(Math.random() * colors.length)];
            for (let i = 0; i < 40; i++) { 
                const angle = Math.random() * Math.PI * 2;
                const force = Math.random() * 6 + 2;
                fireworks.push(new Particle(x, y, color, Math.cos(angle) * force, Math.sin(angle) * force));
            }
        }

        function drawPixelHorse(x, y, f) {
            const isJumping = !horse.grounded;
            const isDucking = horse.ducking;
            const legSwing = (isJumping || isDucking) ? 0 : Math.sin(f * 0.3) * 8;
            const bodyBob = (isJumping || isDucking) ? 0 : Math.cos(f * 0.3) * 2;
            const tailWag = Math.sin((f - 5) * 0.25) * 4;
            const headBob = isDucking ? 8 : (isJumping ? 0 : Math.sin(f * 0.3) * 1.5);

            ctx.save();
            ctx.translate(x, y + bodyBob);
            if (isAwakened) { ctx.shadowBlur = 15; ctx.shadowColor = "rgba(255, 215, 0, 0.7)"; }
            
            if (isAwakened) {
                const wingFlap = Math.sin(f * 0.4) * 12;
                ctx.save();
                ctx.translate(12*s, 6*s);
                ctx.fillStyle = "rgba(255, 215, 0, 0.8)";
                ctx.beginPath(); ctx.moveTo(0, 0); ctx.lineTo(-28*s, -22*s + wingFlap); ctx.lineTo(-12*s, -4*s); ctx.fill();
                ctx.beginPath(); ctx.moveTo(6*s, 0); ctx.lineTo(-24*s, -28*s + wingFlap); ctx.lineTo(-8*s, -8*s); ctx.fill();
                ctx.restore();
            }

            ctx.fillStyle = "#4A2511"; ctx.fillRect(-4*s, 8*s, 4*s, 6*s); ctx.fillRect(-7*s, 12*s + tailWag, 4*s, 8*s);
            ctx.fillStyle = "#5D2E0B"; ctx.fillRect(-9*s, 18*s + tailWag * 1.5, 3*s, 10*s);
            ctx.fillStyle = isNight ? "#8B4513" : "#703809"; ctx.fillRect(4*s, 18*s - (legSwing * 0.5), 6*s, isDucking ? 10*s : 15*s);
            ctx.fillStyle = "#8B4513"; ctx.fillRect(11*s, 18*s + (legSwing * 0.5), 6*s, isDucking ? 10*s : 15*s);
            ctx.fillStyle = isNight ? "#A0522D" : "#8B4513"; ctx.fillRect(4*s, 3*s, 30*s, 18*s);
            ctx.fillStyle = "#A0522D"; ctx.fillRect(8*s, 6*s, 16*s, 3*s);
            ctx.fillStyle = "#703809"; ctx.fillRect(22*s, 18*s + legSwing, 6*s, isDucking ? 10*s : 15*s);
            ctx.fillStyle = "#8B4513"; ctx.fillRect(29*s, 18*s - legSwing, 6*s, isDucking ? 10*s : 15*s);
            ctx.save();
            if (isDucking) { ctx.translate(32*s, 12*s); ctx.rotate(0.3); } else { ctx.translate(28*s, headBob); }
            ctx.fillStyle = "#8B4513"; ctx.fillRect(0, -10*s, 12*s, 22*s);
            ctx.fillStyle = "#703809"; ctx.fillRect(1*s, -22*s, 3*s, 5*s); ctx.fillRect(8*s, -22*s, 3*s, 5*s);
            ctx.fillStyle = "#8B4513"; ctx.fillRect(1*s, -16*s, 16*s, 13*s); ctx.fillRect(17*s, -14*s, 10*s, 11*s);
            ctx.fillStyle = (isNight || isAwakened) ? "#F5F5DC" : "#FFD700"; ctx.fillRect(-3*s, -12*s, 3*s, 18*s); ctx.fillRect(1*s, -20*s, 8*s, 3*s);  
            ctx.fillStyle = "white"; ctx.fillRect(11*s, -13*s, 3*s, 3*s); ctx.fillStyle = "black"; ctx.fillRect(13*s, -11*s, 1.5*s, 1.5*s);
            ctx.restore();
            ctx.fillStyle = "#222"; const hoofY = isDucking ? 26*s : 31*s;
            ctx.fillRect(4*s, hoofY - (legSwing * 0.5), 6*s, 3*s); ctx.fillRect(11*s, hoofY + (legSwing * 0.5), 6*s, 3*s);
            ctx.fillRect(22*s, hoofY + legSwing, 6*s, 3*s); ctx.fillRect(29*s, hoofY - legSwing, 6*s, 3*s);
            ctx.restore();
        }

        function drawObstacle(obs) {
            ctx.save(); ctx.translate(obs.x, obs.y);
            if (isNight) { ctx.shadowBlur = 8; ctx.shadowColor = "rgba(255, 255, 255, 0.3)"; }
            if (obs.type === 'yuanbao') {
                ctx.fillStyle = "#D4AF37"; ctx.beginPath(); ctx.ellipse(obs.width/2, obs.height/2, obs.width/2 + 5, obs.height/2, 0, 0, Math.PI * 2); ctx.fill();
                ctx.fillStyle = "#FFD700"; ctx.beginPath(); ctx.arc(obs.width/2, obs.height/2 - 5, 8, 0, Math.PI * 2); ctx.fill();
            } else if (obs.type === 'red_envelope') {
                ctx.fillStyle = "#e60000"; ctx.fillRect(0, 0, obs.width, obs.height);
                ctx.fillStyle = "gold"; ctx.fillRect(0, 0, obs.width, obs.height * 0.15); 
                ctx.fillStyle = "gold"; ctx.font = "bold 13px serif"; ctx.textAlign = "center"; ctx.textBaseline = "middle"; ctx.fillText("Á¶è", (obs.width / 2) + 1, obs.height * 0.6);
            } else if (obs.type === 'lantern') {
                ctx.fillStyle = isNight ? "#ff4d4d" : "#ff3333"; ctx.beginPath(); ctx.ellipse(obs.width/2, obs.height/2, 15, 18, 0, 0, Math.PI * 2); ctx.fill();
                ctx.fillStyle = "#D4AF37"; ctx.fillRect(obs.width/2 - 10, 0, 20, 3); ctx.fillRect(obs.width/2 - 10, 33, 20, 3);
            }
            ctx.restore();
        }

        function update() {
            fireworks.forEach((p, i) => {
                p.update();
                if (p.opacity <= 0) fireworks.splice(i, 1);
            });

            if (!gameActive) {
                gameOverFrameCount++;
                if (gameOverFrameCount % 40 === 0) createFirework(Math.random() * canvas.width, Math.random() * 100 + 30);
                return;
            }

            // Ë∑ØÁ®ãË®àÁÆóÈÇèËºØÂ¢ûÂº∑ÔºöÈö®ÈÄüÂ∫¶ÂãïÊÖãÂ¢ûÈï∑
            let currentSpeed = (8 + Math.floor(distance / 500) * 0.6);
            distance += (currentSpeed * 0.06); 
            distanceDisplay.innerText = formatNumber(distance);
            
            // ËΩâÂêëÂ§úÊôöÊ®°Âºè
            if (distance >= 1500 && !isNight) {
                isNight = true;
                body.classList.add('is-night');
                statusText.innerText = "Ë∑ùÈõ¢ 2026 ÈÄ≤ÂÖ•È£õÈ¶¨Ê®°Âºè";
                initStars();
            }

            // Ë¶∫ÈÜíÊ®°Âºè
            if (distance >= 2026 && !isAwakened) {
                isAwakened = true; 
                body.classList.add('awakened'); 
                title.innerText = "üåü Êñ∞Êò•Â§ßÂêâüåü";
                awakeningFireworkTimer = 100; 
            }

            if (awakeningFireworkTimer > 0) {
                if (awakeningFireworkTimer % 25 === 0) createFirework(200 + Math.random() * 400, 50 + Math.random() * 50);
                awakeningFireworkTimer--;
            }

            if (!horse.grounded) { horse.dy += horse.gravity; horse.y += horse.dy; }
            if (horse.y >= horse.groundY) { horse.y = horse.groundY; horse.dy = 0; horse.grounded = true; }
            
            if (frame >= nextObstacleFrame) {
                const types = ['yuanbao', 'red_envelope', 'lantern'];
                const randomType = types[Math.floor(Math.random() * types.length)];
                let obsWidth = 22, obsHeight = 15, obsY = 210;
                if (randomType === 'red_envelope') { obsWidth = 22; obsHeight = 32; obsY = 193; }
                else if (randomType === 'lantern') { obsWidth = 30; obsHeight = 35; obsY = 190; }
                obstacles.push({ x: canvas.width + 50, y: obsY, width: obsWidth, height: obsHeight, type: randomType });
                let difficultyGap = Math.max(35, 80 - Math.floor(distance / 1000) * 8);
                nextObstacleFrame = frame + Math.floor(Math.random() * difficultyGap) + 50;
            }
            
            for (let i = obstacles.length - 1; i >= 0; i--) {
                const obs = obstacles[i]; obs.x -= currentSpeed;
                const hbH = horse.ducking ? 15 : 25; const hbY = horse.ducking ? 10 : 0;
                if (horse.x + 8 < obs.x + obs.width && horse.x + 32 > obs.x &&
                    horse.y + hbY < obs.y + obs.height && horse.y + hbY + hbH > obs.y) gameOver();
                if (obs.x < -100) obstacles.splice(i, 1);
            }
            frame++;
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            if (isNight || isAwakened) {
                stars.forEach(star => {
                    star.opacity += star.speed;
                    if (star.opacity > 0.8 || star.opacity < 0.1) star.speed = -star.speed;
                    ctx.save(); ctx.globalAlpha = star.opacity; ctx.fillStyle = "rgba(255, 255, 255, 0.8)";
                    ctx.beginPath(); ctx.arc(star.x, star.y, star.size, 0, Math.PI * 2); ctx.fill(); ctx.restore();
                });
            } else {
                ctx.fillStyle = "rgba(0, 0, 0, 0.05)";
                drawAuspiciousCloud(150 - (frame * 0.4) % 1000, 50); drawAuspiciousCloud(600 - (frame * 0.6) % 1000, 80);
            }
            
            ctx.fillStyle = (isNight || isAwakened) ? "#1a1a3a" : "#f0f0f0"; ctx.fillRect(0, 225, canvas.width, 25);
            ctx.fillStyle = (isNight || isAwakened) ? "#d4af37" : "#8b0000"; 
            let speed = (8 + Math.floor(distance / 500) * 0.6);
            for(let i=0; i<canvas.width + 40; i+=40) {
                ctx.fillRect(i - (frame * speed * 0.3 % 40), 225, 20, 2);
            }
            drawPixelHorse(horse.x, horse.y, frame);
            obstacles.forEach(drawObstacle);

            if (!gameActive) {
                ctx.fillStyle = "rgba(0, 0, 0, 0.8)"; ctx.fillRect(0, 0, canvas.width, canvas.height);
                if (isAwakened) {
                    ctx.save(); ctx.font = "bold 90px 'Ma Shan Zheng', cursive";
                    ctx.shadowColor = "rgba(255, 140, 0, 0.5)"; ctx.shadowBlur = 15;
                    ctx.textAlign = "center"; ctx.textBaseline = "middle";
                    const scale = 1 + Math.sin(gameOverFrameCount * 0.05) * 0.04;
                    ctx.translate(canvas.width / 2, canvas.height / 2 - 20); ctx.scale(scale, scale);
                    const gradient = ctx.createLinearGradient(0, -40, 0, 40);
                    gradient.addColorStop(0, "#F1C40F"); gradient.addColorStop(1, "#E67E22");
                    ctx.fillStyle = gradient; ctx.fillText("Êñ∞Âπ¥Âø´Ê®Ç", 0, 0); ctx.restore();
                } else {
                    ctx.fillStyle = "#fff"; ctx.font = "24px 'Press Start 2P', cursive"; 
                    ctx.textAlign = "center"; ctx.fillText("GAME OVER", canvas.width/2, canvas.height / 2 - 20);
                }
            }
            fireworks.forEach(p => p.draw());
        }

        function drawAuspiciousCloud(x, y) {
            ctx.beginPath(); ctx.arc(x, y, 10, 0, Math.PI * 2); ctx.arc(x + 15, y - 5, 15, 0, Math.PI * 2); ctx.arc(x + 35, y, 10, 0, Math.PI * 2); ctx.fill();
        }

        function gameOver() {
            if (!gameActive) return;
            gameActive = false; gameOverFrameCount = 0;
            if (distance > highScore) { highScore = distance; highScoreDisplay.innerText = formatNumber(highScore); }
            restartBtn.style.display = 'flex';
            createFirework(canvas.width / 2, 100); createFirework(canvas.width / 4, 150); createFirework(3 * canvas.width / 4, 150);
        }

        function resetGame() {
            distance = 0; frame = 0; nextObstacleFrame = 100; obstacles.length = 0; fireworks.length = 0; 
            horse.y = horse.groundY; horse.dy = 0; horse.grounded = true; horse.ducking = false;
            gameActive = true; isNight = false; isAwakened = false; awakeningFireworkTimer = 0; gameOverFrameCount = 0;
            body.classList.remove('is-night', 'awakened'); title.innerText = "üßßüêéüßßüêéüßß";
            statusText.innerText = "Ë∑ùÈõ¢ 1500 ÈÄ≤ÂÖ•ÊòüÁ©∫Ê®°Âºè";
            distanceDisplay.innerText = formatNumber(0); restartBtn.style.display = 'none';
        }

        function handleJump() {
            if (gameActive && horse.grounded) { horse.dy = -horse.jumpForce; horse.grounded = false; horse.ducking = false; }
            else if (!gameActive && gameOverFrameCount > 30) resetGame();
        }
        function handleDuck(v) { if (gameActive && horse.grounded) horse.ducking = v; }
        function handleClick() { handleJump(); }
        window.addEventListener('keydown', (e) => { 
            if (e.code === 'Space' || e.code === 'ArrowUp') { e.preventDefault(); handleJump(); }
            if (e.code === 'ArrowDown') { e.preventDefault(); handleDuck(true); }
        });
        window.addEventListener('keyup', (e) => { if (e.code === 'ArrowDown') handleDuck(false); });

        function gameLoop() { update(); draw(); requestAnimationFrame(gameLoop); }
        gameLoop();
    </script>
</body>
</html>
